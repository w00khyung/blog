---
title: Radix UI, asChild patternì— ëŒ€í•´ì„œ
date: '2024-03-20'
tags: ['React']
draft: false
summary: Radix UI, asChild patternì˜ ë‚´ë¶€ êµ¬í˜„ ë°©ì‹ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ì.
---

![](/static/images/radix-ui.png)

<TOCInline toc={props.toc} />

## ğŸ‘‹ ì‹œì‘í•˜ê¸°ì— ì•ì„œì„œ

ìµœê·¼ Storybookì„ í†µí•´ì„œ ë””ìì¸ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ë‹¤ê°€ ê³µí†µ ì»´í¬ë„ŒíŠ¸ì˜ íƒœê·¸ë¥¼ ë³€ê²½í•˜ê±°ë‚˜ ê³µí†µ ì»´í¬ë„ŒíŠ¸ì˜ ë™ì‘ì„ childrenìœ¼ë¡œ ë°›ëŠ” ìì‹ ì»´í¬ë„ŒíŠ¸ë¡œ ë„˜ê¸°ê³  ì‹¶ì€ ê²½ìš°ê°€ ìˆì—ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, ê³µìš© Button ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ”ë° í´ë¦­ ì‹œ ë‹¤ë¥¸ í˜ì´ì§€ë¡œ ì´ë™í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— `button` íƒœê·¸ê°€ ì•„ë‹Œ `Link` (`a` íƒœê·¸)ë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ì„ ìˆ˜ ìˆë‹¤.

```tsx
<Link href='...'>
  <Button>
    ë§í¬ ì´ë™
  </Button>
<Link>
```

ì´ë ‡ê²Œ êµ¬í˜„í•´ë„ ì‘ë™í•˜ì§€ë§Œ, HTML5 specificationì— ë”°ë¥´ë©´ `button` íƒœê·¸ ë‚´ì— `a` íƒœê·¸ë¥¼ ì¤‘ì²©í•˜ëŠ” ê²ƒì€ ëª…ì„¸ë¥¼ ìœ„ë°˜í•˜ëŠ” ë°©ë²•ì´ë‹¤. (ë°˜ëŒ€ë¡œ `button` íƒœê·¸ ë‚´ì— `a` íƒœê·¸ë¥¼ ì¤‘ì²©í•´ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒë„)

- https://html.spec.whatwg.org/multipage/text-level-semantics.html#the-a-element

> Content model:
>
> Transparent, but there must be no interactive content descendant, a element descendant, or descendant with the tabindex attribute specified.
>
> - https://html.spec.whatwg.org/multipage/dom.html#interactive-content-2

`a` íƒœê·¸ ë‚´ë¶€ì—ëŠ” ìƒí˜¸ ì‘ìš©ì´ ê°€ëŠ¥í•œ í•˜ìœ„ ìš”ì†Œ, `a` íƒœê·¸ í•˜ìœ„ ìš”ì†Œ ë˜ëŠ” `tabindex` ì†ì„±ì´ ì§€ì •ëœ í•˜ìœ„ ìš”ì†Œê°€ ì—†ì–´ì•¼ í•œë‹¤. ì—¬ê¸°ì„œ ìƒí˜¸ ì‘ìš©ì´ ê°€ëŠ¥í•œ í•˜ìœ„ ìš”ì†Œë€ `button`, `input` (type ì†ì„±ì´ hiddenì´ ì•„ë‹Œ), `select` ë“±ê³¼ ê°™ì´ ìƒí˜¸ì‘ìš©ì„ ìœ„í•´ ë§Œë“¤ì–´ì§„ íƒœê·¸ë“¤ì„ ë§í•œë‹¤.

ì°¸ê³ ë¡œ Next.jsì—ì„œë„ HTML ëª…ì„¸ì— ìœ„ë°˜í•˜ì—¬ ì¤‘ì²©ëœ HTML íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, Hydration ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¤ë©° ìœ„ì™€ ë¹„ìŠ·í•œ ì„¤ëª…ì´ ê³µì‹ë¬¸ì„œì— ì¨ì ¸ìˆë‹¤.

- https://nextjs.org/docs/messages/react-hydration-error#common-causes

ìœ„ì™€ ê°™ì€ ìƒí™© ë•Œë¬¸ì— í•„ìš” í•  ê²½ìš° ì»´í¬ë„ŒíŠ¸ì˜ ê¸°ë³¸ íƒœê·¸ë¥¼ ë³€ê²½(`button` -> `a`)í•´ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìœ¼ë©°, Chakra UIë‚˜ Reakitì—ì„œ ìì£¼ ì‚¬ìš©í•˜ëŠ” as prop patternì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

- https://chakra-ui.com/docs/styled-system/style-props#the-as-prop

- https://reakit.io/docs/composition/#as-prop

```tsx
export function Button({ as, ...props }) {
  const Comp = as ?? 'button'

  return <Comp {...props} />
}

;<Button as={Link} />
```

ê·¸ëŸ¬ë‚˜ ë” ë§ì€ ì‚¬ìš©ì ì •ì˜ë¥¼ í—ˆìš©í•˜ë ¤ë©´, ì˜ˆë¥¼ ë“¤ì–´ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì— propsì— ì „ë‹¬í•˜ë ¤ë©´ `as` propì´ ë¬¸ì œê°€ ë  ìˆ˜ ìˆë‹¤. TypeScriptë¥¼ í†µí•´ì„œ ì¶©ë¶„íˆ êµ¬í˜„ ê°€ëŠ¥í•˜ì§€ë§Œ ì„¤ì •í•˜ê¸°ê°€ ë³µì¡í•´ì§€ê³  ëŸ°íƒ€ì„ì— ëŠë ¤ì§ˆ ìˆ˜ ìˆë‹¤.

```tsx
<Button
  as='a'
  target='_blank'
  variant='outline'
  href='...'
  ...
>
  Hello
</Button>
```

---

## ğŸ¤” asChild pattern

`asChild` patternì€ Radixì—ì„œ ë§ì´ ì‚¬ìš©ë˜ë©°, `as` prop patternì— ë¹„êµí•˜ë©´ êµ¬í˜„í•˜ê¸° ì‰¬ìš°ë©° ì´í•´í•˜ê¸°ì—ë„ ì‰½ë‹¤.

```tsx
<Button asChild>
  <a target="_blank" href="..." />
</Button>
```

- asChild ê°€ falseì¼ ë•Œ, ê¸°ë³¸ ì»´í¬ë„ŒíŠ¸(button)ë¥¼ ë Œë”ë§í•œë‹¤.
- asChild ê°€ trueì¼ ë•ŒëŠ” ìì‹ ì»´í¬ë„ŒíŠ¸(a)ë¥¼ ë Œë”ë§í•œë‹¤.

Radixë¥¼ ì‚¬ìš©í•˜ë‹¤ ë³´ë©´ ì£¼ë¡œ `Trigger` ê°™ì€ ì»´í¬ë„ŒíŠ¸ì—ì„œ `asChild` propsë¥¼ ë§Œë‚˜ê²Œ ë˜ëŠ”ë°, ì„¤ëª…ê³¼ í•¨ê»˜ ì–´ë–»ê²Œ ì‚¬ìš©í•˜ê³  ìˆëŠ”ì§€ ì‚´í´ë³´ì. Radixì—ì„œ `asChild`ì˜ íˆ´íŒì—ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì„¤ëª…ë˜ì–´ ìˆë‹¤.

> ìì‹ìœ¼ë¡œ ì „ë‹¬ëœ ìš”ì†Œì˜ ê¸°ë³¸ ë Œë”ë§ ìš”ì†Œë¥¼ ë³€ê²½í•˜ì—¬ propsì™€ ë™ì‘ì„ ë³‘í•©í•œë‹¤.

ì„¤ëª…ë§Œ ë“¤ìœ¼ë©´ ë‚œí•´í•œë°, ì˜ˆì œ ì½”ë“œë¥¼ ì‚´í´ë³´ì.

- https://www.radix-ui.com/primitives/docs/guides/composition

```tsx
import * as React from 'react'
import * as Tooltip from '@radix-ui/react-tooltip'

export default () => (
  <Tooltip.Root>
    <Tooltip.Trigger asChild>
      âœ… a íƒœê·¸ì— Tooltip.Triggerì˜ propsì™€ ë™ì‘ì´ ìì‹ íƒœê·¸ì¸ aë¡œ ë³‘í•©ëœë‹¤.
      <a href="https://www.radix-ui.com/">Radix UI</a>
    </Tooltip.Trigger>
    <Tooltip.Portal>â€¦</Tooltip.Portal>
  </Tooltip.Root>
)
```

ë‹¤ë§Œ, ìœ„ ê°™ì´ ê¸°ë³¸ íƒœê·¸ë¥¼ ë³€ê²½(`button` -> `a`)í•˜ê¸°ë¡œ ê²°ì •í–ˆë‹¤ë©´, ì ‘ê·¼ì„±ê³¼ ê¸°ëŠ¥ì„ ìœ ì§€í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê²ƒì€ ì‚¬ìš©ìì˜ ì±…ì„ì´ë‹¤. ì˜ˆë¥¼ ë“¤ì–´ Tooltip.TriggerëŠ” í¬ì¸í„° ë° í‚¤ë³´ë“œ ì´ë²¤íŠ¸ì— ë°˜ì‘í•  ìˆ˜ ìˆëŠ” í¬ì»¤ìŠ¤ ê°€ëŠ¥í•œ ìš”ì†Œì—¬ì•¼ í•œë‹¤. ë§Œì•½ ì´ë¥¼ `div` íƒœê·¸ë¡œ ë³€ê²½í•˜ë©´ ë” ì´ìƒ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ì—†ê²Œ ëœë‹¤.

ì‹¤ì œë¡œëŠ” ìœ„ì²˜ëŸ¼ ê¸°ë³¸ DOM ìš”ì†Œë¥¼ ì§ì ‘ ìˆ˜ì •í•´ì•¼ í•˜ëŠ” ì¼ì€ ê±°ì˜ ì—†ê³ , ëŒ€ì‹  ìì²´ React ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” ì¼ë°˜ì ì´ë‹¤. Triggerì˜ ê²½ìš° ì£¼ë¡œ ì‚¬ìš©ë˜ëŠ” ì´ìœ ê°€ ë””ìì¸ ì‹œìŠ¤í…œì˜ ì‚¬ìš©ì ì •ì˜ ë²„íŠ¼, ë§í¬ì™€ í•¨ê»˜ Triggerì˜ ê¸°ëŠ¥ì„ ë³‘í•©í•´ì„œ ì‚¬ìš©í•˜ê³ ì í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

```tsx
import * as React from 'react'
import * as Tooltip from '@radix-ui/react-tooltip'

export default () => (
  <Tooltip.Root>
    <Tooltip.Trigger asChild>
      âœ… Button ì»´í¬ë„ŒíŠ¸ì— Triggerì˜ ê¸°ëŠ¥ì´ ë³‘í•©ëœë‹¤.
      <Button>Radix UI</Button>
    </Tooltip.Trigger>
    <Tooltip.Portal>â€¦</Tooltip.Portal>
  </Tooltip.Root>
)
```

---

## ğŸ” Slot Component

ê·¸ë ‡ë‹¤ë©´ asChild patternì€ ì–´ë–»ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆì„ê¹Œ? Radixì˜ ì†ŒìŠ¤ì½”ë“œë¥¼ í†µí•´ ì–´ë–»ê²Œ êµ¬í˜„ë˜ì–´ ìˆëŠ”ì§€ ì‚´í´ë³´ì.

radix-ui/themesì˜ base-button.tsx ì†ŒìŠ¤ì½”ë“œë¥¼ ë³´ë©´ Slot ì»´í¬ë„ŒíŠ¸ë¥¼ í†µí•´ì„œ êµ¬í˜„ë˜ì–´ ìˆëŠ”ê±¸ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

- https://github.com/radix-ui/themes/blob/main/packages/radix-ui-themes/src/components/base-button.tsx

```tsx
const BaseButton = React.forwardRef<BaseButtonElement, BaseButtonProps>((props, forwardedRef) => {
  ...
  const {
    ...
    asChild,
  } = extractProps(props, baseButtonPropDefs, marginPropDefs);
  const Comp = asChild ? Slot : 'button';
  return (
    <Comp>
      {props.loading ? (
        <>
          ...
        </>
      ) : (
        children
      )}
    </Comp>
  );
});
```

Radix ê³µì‹ë¬¸ì„œì— ë”°ë¥´ë©´, Slot ì»´í¬ë„ŒíŠ¸ëŠ” propsë¥¼ ìì‹ì— ë³‘í•©í•˜ê¸° ìœ„í•œ ì»´í¬ë„ŒíŠ¸ë‹¤.

- https://www.radix-ui.com/primitives/docs/utilities/slot

```tsx
import React from 'react'
import { Slot } from '@radix-ui/react-slot'

function Button({ asChild, ...props }) {
  const Comp = asChild ? Slot : 'button'
  return <Comp {...props} />
}
```

ì¦‰, asChild patternì„ ì§€ì›í•˜ê¸° ìœ„í•´ ë§Œë“¤ì–´ì§„ ì»´í¬ë„ŒíŠ¸ì¸ë° ë‚´ë¶€ êµ¬í˜„ì€ ì–´ë–»ê²Œ ë˜ì–´ìˆì„ê¹Œ?

- https://github.com/radix-ui/primitives/blob/main/packages/react/slot/src/Slot.tsx

```tsx
const Slot = React.forwardRef<HTMLElement, SlotProps>((props, forwardedRef) => {
  const { children, ...slotProps } = props

  // 1. ìì‹ìš”ì†Œ ì¤‘ì— Slottable ì»´í¬ë„ŒíŠ¸ê°€ ìˆëŠ”ì§€ í™•ì¸í•œë‹¤.
  const childrenArray = React.Children.toArray(children)
  const slottable = childrenArray.find(isSlottable)

  // 2. ë§Œì•½ Slottable ì»´í¬ë„ŒíŠ¸ê°€ ìˆìœ¼ë©´,
  if (slottable) {
    // Slottable ì»´í¬ë„ŒíŠ¸ì˜ ìì‹ ìš”ì†Œë¥¼ newElementì— í• ë‹¹í•œë‹¤.
    const newElement = slottable.props.children as React.ReactNode

    // childrenArrayë¥¼ ìˆœíšŒí•˜ë©´ì„œ ìƒˆë¡œìš´ ìì‹ ìš”ì†Œë¥¼ ìƒì„±í•œë‹¤.
    // Slottable ì»´í¬ë„ŒíŠ¸ë¥¼ ë°œê²¬í•˜ë©´ í•´ë‹¹ ìì‹ ìš”ì†Œë¥¼ newElementë¡œ êµì²´í•œë‹¤.
    const newChildren = childrenArray.map((child) => {
      if (child === slottable) {
        // ìƒˆ ìš”ì†Œê°€ ë Œë”ë§ë˜ëŠ” ìš”ì†Œê°€ ë  ê²ƒì´ê¸° ë•Œë¬¸ì—,
        // ê·¸ ìš”ì†Œë¥¼ (newElement.props.children) ì¡ëŠ” ë°ë§Œ ê´€ì‹¬ì´ ìˆë‹¤.
        if (React.Children.count(newElement) > 1) return React.Children.only(null)
        return React.isValidElement(newElement)
          ? (newElement.props.children as React.ReactNode)
          : null
      } else {
        return child
      }
    })

    // 3. Slottable ì»´í¬ë„ŒíŠ¸ê°€ ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš°, ê¸°ì¡´ì˜ childrenì„ ê·¸ëŒ€ë¡œ ë Œë”ë§í•œë‹¤.
    return (
      <SlotClone {...slotProps} ref={forwardedRef}>
        {React.isValidElement(newElement)
          ? React.cloneElement(newElement, undefined, newChildren)
          : null}
      </SlotClone>
    )
  }

  return (
    <SlotClone {...slotProps} ref={forwardedRef}>
      {children}
    </SlotClone>
  )
})

const SlotClone = React.forwardRef<any, SlotCloneProps>((props, forwardedRef) => {
  const { children, ...slotProps } = props

  // childrenì´ ìœ íš¨í•œ React ìš”ì†Œì¸ì§€ í™•ì¸í•œë‹¤.
  if (React.isValidElement(children)) {
    // React.cloneElementì„ ì‚¬ìš©í•˜ì—¬ childrenì„ ë³µì œí•œë‹¤. ì´ë•Œ, ìƒˆë¡œìš´ ì†ì„±ì„ ì ìš©í•˜ì—¬ ë°˜í™˜í•œë‹¤.
    return React.cloneElement(children, {
      // mergeProps í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ slotPropsì™€ children.propsë¥¼ ë³‘í•©í•œë‹¤.
      // ì´ë¥¼ í†µí•´ Slot ì»´í¬ë„ŒíŠ¸ì˜ ì†ì„±ê³¼ í•´ë‹¹ ìì‹ ìš”ì†Œì˜ ì†ì„±ì„ í•¨ê»˜ ì ìš©í•  ìˆ˜ ìˆë‹¤.
      ...mergeProps(slotProps, children.props),
      // ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì „ë‹¬ëœ refì™€ í•¨ê»˜ ë™ì‘í•˜ë„ë¡ í•œë‹¤.
      // composeRefs í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‘ ê°œì˜ refë¥¼ ê²°í•©í•œë‹¤.
      ref: forwardedRef ? composeRefs(forwardedRef, (children as any).ref) : (children as any).ref,
    })
  }

  // childrenì´ ìœ íš¨í•œ React ìš”ì†Œê°€ ì•„ë‹ˆê±°ë‚˜, childrenì´ ì—¬ëŸ¬ ê°œì¼ ê²½ìš°ì—ëŠ” nullì„ ë°˜í™˜í•œë‹¤.
  // ì´ë ‡ê²Œ í•¨ìœ¼ë¡œì¨ childrenì´ ë‹¨ì¼ ìš”ì†Œì¼ ë•Œë§Œ ì²˜ë¦¬ë˜ë„ë¡ í•œë‹¤.
  return React.Children.count(children) > 1 ? React.Children.only(null) : null
})

const Slottable = ({ children }: { children: React.ReactNode }) => {
  return <>{children}</>
}

// childê°€ React ìš”ì†Œì¸ì§€ í™•ì¸í•˜ê³ , typeì´ 'Slottable' ì»´í¬ë„ŒíŠ¸ì¸ì§€ í™•ì¸í•œë‹¤.
function isSlottable(child: React.ReactNode): child is React.ReactElement {
  return React.isValidElement(child) && child.type === Slottable
}
```

ì •ë¦¬í•´ë³´ë©´,

1. Slot: ì£¼ì–´ì§„ ìì‹ ìš”ì†Œì˜ ì†ì„±ì„ ë³‘í•©í•˜ê³  í•´ë‹¹ ìš”ì†Œë¥¼ ë Œë”ë§í•œë‹¤. ì´ ì»´í¬ë„ŒíŠ¸ëŠ” SlotClone ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‚´ë¶€ì ìœ¼ë¡œ ë Œë”ë§í•œë‹¤.

2. SlotClone: Slotì˜ ìì‹ ìš”ì†Œë¥¼ ë³µì œí•˜ê³  í•´ë‹¹ ìš”ì†Œì— ì†ì„±ì„ ë³‘í•©í•œ í›„ ë Œë”ë§í•œë‹¤.

3. Slottable: Slot ì»´í¬ë„ŒíŠ¸ì˜ ìì‹ ìš”ì†Œë¡œ ì‚¬ìš©ë˜ë©°, Slotì´ ë Œë”ë§í•  ëŒ€ìƒì´ë‹¤.

## âœ¨ ëë‚´ë©°

ì´ë ‡ê²Œ as prop patternìœ¼ë¡œ ì‹œì‘í•´ì„œ, Radixì˜ asChild prop patternê¹Œì§€ ì‚´í´ë³´ì•˜ë‹¤. Slot ì»´í¬ë„ŒíŠ¸ì˜ ë‚´ë¶€ êµ¬í˜„ì„ ë³´ë©´ì„œ propsë¥¼ ë³‘í•©í•˜ëŠ” `mergeProps`ë‚˜ refë¥¼ ê²°í•©í•˜ëŠ” `composeRefs`ê°™ì€ í—¬í¼ í•¨ìˆ˜ë„ ì•Œ ìˆ˜ ìˆì—ˆê³ , `React.isValidElement`, `React.cloneElement`, `React.Children.count`, `React.Children.toArray` ê°™ì€ ìì£¼ ì‚¬ìš©í•˜ì§€ ì•Šê±°ë‚˜ ì²˜ìŒ ë³´ëŠ” ë©”ì„œë“œë“¤ë„ ë§Œë‚˜ê²Œ ë˜ì–´ í¥ë¯¸ë¡œì› ë‹¤.

Slot ì»´í¬ë„ŒíŠ¸ ì™¸ì—ë„ ë‹¤ë¥¸ UI ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ êµ¬í˜„ë„ ì‚´í´ë³´ë©´ì„œ í¥ë¯¸ë¡œìš´ ì ì´ ìˆìœ¼ë©´ ë‹¤ìŒ í¬ìŠ¤íŒ…ì— ì´ì–´ì§€ì§€ ì•Šì„ê¹Œ ì‹¶ë‹¤. ë!
